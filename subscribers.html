<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
    <link rel="stylesheet" href="style.css?v=25.0">
    <link rel="stylesheet" href="style-fab.css?v=1.0">
    <link rel="stylesheet" href="style-modal.css?v=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="auth-system.js"></script>
    <script>AuthSystem.checkSession();</script>


    <script type="module">
        import { DataManager } from './data-manager.js';
        window.DataManager = DataManager;
        DataManager.init();
    </script>

</head>

</head>

<body>
    <!-- Mobile Header & Toggle -->
    <button class="menu-btn" onclick="toggleMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar / Drawer Navigation -->
    <nav class="navbar" id="main-nav">
        <div class="header-card"
            style="margin: 0; background: none; box-shadow: none; border: none; padding: 0 0 20px 0;">
            <div class="logo" style="color: var(--primary); font-size: 1.5rem; margin-bottom: 0;">
                <i class="fas fa-chart-line"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            </div>
            <button class="close-menu" onclick="toggleMenu()"
                style="position: absolute; left: 0; top: 0;">&times;</button>
        </div>

        <ul class="nav-links">
            <li><a href="index.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li id="nav-subscribers"><a href="subscribers.html" class="active"><i class="fas fa-users"></i>
                    Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</a></li>
            <li id="nav-active"><a href="active_subscribers.html"><i class="fas fa-signal"></i> Ø§Ù„ÙØ¹Ø§Ù„ÙŠÙ†</a></li>
            <li id="nav-debts"><a href="debts.html"><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ø¯ÙŠÙˆÙ†</a></li>
            <li id="nav-payments"><a href="payments.html"><i class="fas fa-hand-holding-usd"></i> Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</a></li>
            <li id="nav-reports"><a href="reports.html"><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a></li>
            <li id="nav-employees"><a href="employees.html"><i class="fas fa-users-cog"></i> Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</a></li>

            <li id="nav-telegram"><a href="telegram-settings.html"><i class="fab fa-telegram"></i> Telegram</a></li>
            <li><a href="#" onclick="AuthSystem.logout()"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</a></li>
        </ul>

        <div class="nav-overlay" onclick="toggleMenu()"></div>
    </nav>

    <div class="container">
        <div class="header-card">
            <div>
                <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</h1>
                <p>Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
            </div>
            <div>
                <button onclick="openAddModal()" class="btn btn-primary">
                    <i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø´ØªØ±Ùƒ
                </button>
            </div>
        </div>

        <!-- Search with better visibility -->
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ..." onkeyup="renderPage()">
                <i class="fas fa-search"></i>
            </div>
        </div>

        <!-- Ø£Ø¯Ø§Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (Ù…Ø¤Ù‚ØªØ©) -->
        <div style="margin-bottom: 20px; text-align: center;">
            <details>
                <summary style="cursor: pointer; color: var(--text-sub); font-size: 0.9rem;">Ø£Ø¯ÙˆØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø© / Ø§Ø³ØªÙŠØ±Ø§Ø¯
                </summary>
                <div
                    style="background: #fff; padding: 20px; border-radius: var(--radius-lg); margin-top: 10px; border: 1px dashed #ccc;">
                    <p>ÙŠÙˆØ¬Ø¯ 104 Ø§Ø³Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯.</p>
                    <button onclick="importLegacySubscribers()" id="btn-import" class="btn btn-primary">
                        <i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ 104 Ù…Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†
                    </button>
                    <div id="import-status" style="margin-top: 10px; font-size: 0.9rem; color: green;"></div>
                </div>
            </details>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h3>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</h3>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø¯ÙŠÙ†</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal: Add Subscriber -->
    <div id="addSubscriberModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø´ØªØ±Ùƒ Ø¬Ø¯ÙŠØ¯</h3>
                <button class="close-btn" onclick="closeAddModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="new-name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…">
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="new-phone" placeholder="07..." pattern="[0-9]{11}" maxlength="11"
                        title="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø¹Ø±Ø§Ù‚ÙŠ ØµØ­ÙŠØ­ (11 Ø±Ù‚Ù…)">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ (Ø¥Ù† ÙˆØ¬Ø¯)</label>
                    <input type="number" inputmode="numeric" id="new-price" value="0">
                </div>
                <button onclick="saveNewSubscriber()" class="btn btn-primary btn-full" id="saveSubBtn">
                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Subscriber Actions (Professional) -->
    <div id="actionModal" class="modal-overlay">
        <div class="modal-box" style="text-align: center;">
            <div class="modal-header">
                <h3 id="actionSubName">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ùƒ</h3>
                <button class="close-btn" onclick="closeActionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <button onclick="actionActivate()" class="btn btn-success"
                        style="padding: 20px; flex-direction: column; gap: 10px;">
                        <i class="fas fa-wifi" style="font-size: 2rem;"></i>
                        <span>ØªÙØ¹ÙŠÙ„ / ØªØ¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="actionEdit()" class="btn btn-primary"
                        style="padding: 20px; flex-direction: column; gap: 10px;">
                        <i class="fas fa-edit" style="font-size: 2rem;"></i>
                        <span>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª</span>
                    </button>
                </div>
                <!-- Call Button -->
                <button onclick="actionCall()" class="btn btn-success btn-full" id="callBtn"
                    style="margin-bottom: 15px; display: none;">
                    <i class="fas fa-phone"></i> Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø´ØªØ±Ùƒ
                </button>
                <button onclick="actionDelete()" class="btn btn-outline btn-full"
                    style="color: var(--danger); border-color: var(--danger);">
                    <i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ù…Ø´ØªØ±Ùƒ
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Quick Activate -->
    <div id="quickActivateModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3>ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
                <button class="close-btn" onclick="closeQuickActivate()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="qa-id">
                <input type="hidden" id="qa-fid">
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
                    <input type="number" inputmode="numeric" id="qa-price" value="35000">
                </div>
                <div class="form-group">
                    <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    <select id="qa-type">
                        <option value="Ù†Ù‚Ø¯">Ù†Ù‚Ø¯ (ÙˆØ§ØµÙ„)</option>
                        <option value="Ø£Ø¬Ù„">Ø£Ø¬Ù„ (Ø¯ÙŠÙ†)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ</label>
                    <input type="date" id="qa-end">
                </div>
                <button onclick="saveQuickActivate()" class="btn btn-success btn-full">ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø¢Ù†</button>
            </div>
        </div>
    </div>

    <script>
        let selectedSubscriber = null;

        window.renderPage = function () {
            if (typeof DataManager === 'undefined') return;
            const q = document.getElementById('search').value;
            const subs = DataManager.searchSubscribers(q);
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (subs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:30px; color:var(--secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶</td></tr>';
                return;
            }

            subs.forEach(s => {
                // 1. Calculate Status Dynamically
                let statusHtml = '<span class="badge" style="background:#f3f4f6; color:#6b7280">Ø¬Ø¯ÙŠØ¯</span>';
                const expiry = s.expiryDate || s.endDate;

                if (expiry) {
                    const end = new Date(expiry);
                    const now = new Date();
                    now.setHours(0, 0, 0, 0);
                    end.setHours(0, 0, 0, 0);

                    const diffTime = end - now;
                    const daysLeft = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    if (daysLeft < 0) {
                        statusHtml = `<span class="badge badge-danger">Ù…Ù†ØªÙ‡ÙŠ</span>`;
                    } else if (daysLeft <= 3) {
                        statusHtml = `<span class="badge badge-warning">Ø¨Ø§Ù‚ÙŠ ${daysLeft} ÙŠÙˆÙ…</span>`;
                    } else {
                        statusHtml = `<span class="badge badge-success">Ø¨Ø§Ù‚ÙŠ ${daysLeft} ÙŠÙˆÙ…</span>`;
                    }
                }


                let debtClass = (s.price && parseInt(s.price) > 0) ? 'text-danger' : 'text-success';
                let debtText = (s.price && parseInt(s.price) > 0) ? parseInt(s.price).toLocaleString() : 'ÙˆØ§ØµÙ„';

                // Add click event to the row
                tbody.innerHTML += `
                    <tr onclick="openActionModal('${s.id}')" style="cursor: pointer;">
                        <td data-label="Ø§Ù„Ø§Ø³Ù…" style="font-weight:bold;">${s.name}</td>
                        <td data-label="Ø§Ù„Ù‡Ø§ØªÙ">${s.phone || '-'}</td>
                        <td data-label="Ø§Ù„Ø­Ø§Ù„Ø©">${statusHtml}</td>
                        <td data-label="Ø§Ù„Ø¯ÙŠÙ†" class="${debtClass}" style="font-weight:bold;">
                            ${debtText}
                        </td>
                    </tr>
                `;
            });
        };

        // Open Action Modal
        window.openActionModal = function (id) {
            selectedSubscriber = DataManager.getSubscriber(id);
            if (!selectedSubscriber) return;

            document.getElementById('actionSubName').innerText = selectedSubscriber.name;

            // Show/hide call button based on phone availability
            const callBtn = document.getElementById('callBtn');
            if (selectedSubscriber.phone && selectedSubscriber.phone.trim()) {
                callBtn.style.display = 'block';
            } else {
                callBtn.style.display = 'none';
            }

            document.getElementById('actionModal').classList.add('active');
        };

        window.closeActionModal = () => document.getElementById('actionModal').classList.remove('active');

        // Action: Call Subscriber
        window.actionCall = function () {
            if (!selectedSubscriber || !selectedSubscriber.phone) return;
            window.location.href = 'tel:' + selectedSubscriber.phone;
        };

        // Action Handlers
        window.actionActivate = function () {
            closeActionModal();
            // Open Quick Activate Modal
            const today = new Date();
            const nextMonth = new Date();
            nextMonth.setDate(today.getDate() + 30);

            document.getElementById('qa-id').value = selectedSubscriber.id;
            document.getElementById('qa-fid').value = selectedSubscriber.firebaseId;
            document.getElementById('qa-end').value = nextMonth.toISOString().split('T')[0];
            document.getElementById('quickActivateModal').classList.add('active');
        };

        window.closeQuickActivate = () => document.getElementById('quickActivateModal').classList.remove('active');

        window.saveQuickActivate = async function () {
            const fid = document.getElementById('qa-fid').value;
            const id = document.getElementById('qa-id').value;
            const price = document.getElementById('qa-price').value;
            const type = document.getElementById('qa-type').value;
            const end = document.getElementById('qa-end').value;

            try {
                await DataManager.renewSubscription(fid, id, {
                    price: parseInt(price),
                    type: type,
                    dateEnd: end
                });
                closeQuickActivate();
                DataManager.showToast('âœ… ØªÙ… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (e) {
                DataManager.showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯', 'error');
            }
        };

        window.actionEdit = async function () {
            closeActionModal();
            const newName = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…:", selectedSubscriber.name);
            const newPhone = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‡Ø§ØªÙ:", selectedSubscriber.phone);

            if (newName && newName !== selectedSubscriber.name || newPhone !== selectedSubscriber.phone) {
                await DataManager.updateSubscriber(selectedSubscriber.id, { name: newName, phone: newPhone });
            }
        };

        window.actionDelete = async function () {
            closeActionModal();
            await DataManager.deleteSubscriber(selectedSubscriber.id);
        };

        window.openAddModal = () => document.getElementById('addSubscriberModal').classList.add('active');
        window.closeAddModal = () => document.getElementById('addSubscriberModal').classList.remove('active');

        window.saveNewSubscriber = async function () {
            const btn = document.getElementById('saveSubBtn');
            const name = document.getElementById('new-name').value;
            const phone = document.getElementById('new-phone').value;
            const price = document.getElementById('new-price').value || 0;

            if (!name) return DataManager.showToast('âš ï¸ ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');

            btn.disabled = true;
            btn.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

            try {
                await DataManager.addSubscriber({
                    name: name,
                    phone: phone,
                    initialPrice: parseInt(price),
                    status: 'Ù†Ø´Ø·',
                    paymentType: parseInt(price) > 0 ? 'Ø£Ø¬Ù„' : 'Ù†Ù‚Ø¯',
                    expiryDate: ''
                });

                closeAddModal();
                document.getElementById('new-name').value = '';
                document.getElementById('new-phone').value = '';
            } catch (e) {
                DataManager.showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
            }
        };

        window.loading = false;
        window.updatePageData = window.renderPage;
        setInterval(() => { if (typeof DataManager !== 'undefined') renderPage(); }, 1000);

        // ğŸ“¢ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
        const legacyNames = [
            "ÙˆÙ„ÙŠØ¯ Ù…Ø§Ø¬Ø¯ Ø§Ù„Ø­Ø´Ø¯ Ø¬ÙŠØ±Ø§Ù† Ù„ÙˆÙŠ", "ÙˆØ³Ø§Ù… Ù…Ù‚Ø§Ø¨Ù„ Ù†Ø´ÙˆØ§Ù†", "ÙˆØ³Ø§Ù… Ø§Ù„Ø¹ÙƒÙŠÙ„ÙŠ", "Ù†ÙˆÙˆØ­", "Ù†Ø´ÙˆØ§Ù†",
            "Ù†Ø¬Ø§Ø­ Ø§Ø¨Ùˆ Ø¹Ù„ÙŠ Ø¬Ø§Ø± Ø³ÙŠØ¯ Ø·Ø§Ù„Ø¨", "Ù…ÙˆÙ…Ù„ ØµØ¯ÙŠÙ‚ÙŠ", "Ù…ÙˆØ³Ù‰ Ø¬Ø§Ø± Ø³ÙŠØ¯ Ù‡Ø§Ø¯ÙŠ", "Ù…Ù‡Ù†Ø¯ Ø´Ø§ÙƒØ± ØªÙØ¹ÙŠÙ„ ÙŠÙˆÙ… 22",
            "Ù…Ù‡Ø¯ÙŠ ÙÙ„ÙŠØ­", "Ù…Ù‡Ø¯ÙŠ Ø§Ø³ÙˆØ§Ù‚", "Ù…ØµØ·ÙÙ‰ Ø®Ù„ÙŠÙ„", "Ù…Ø±ØªØ¶Ù‰ Ù†Ø¹Ù…Ø§Ù†ÙŠØ©", "Ù…Ø­Ù…Ø¯Ø§Ù„Ù…Ø±Ø´Ø¯Ø§ÙˆÙŠ",
            "Ù…Ø­Ù…Ø¯ Ù…Ù‚Ø§Ø¨ÙŠÙ„ Ø¹ÙˆÙŠØ¯", "Ù…Ø­Ù…Ø¯ ÙƒØ±Ø§Ø¬ Ø§Ù„ØºØ§Ø² Ø§Ù„Ø¨ÙŠØª 35", "Ù…Ø­Ù…Ø¯ ÙƒØ§Ø±Ø¬ Ø§Ù„ØºØ§Ø²", "Ù…Ø­Ù…Ø¯ Ø´Ø¨ÙˆØ· Ø¬Ø¯ÙŠØ¯",
            "Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø± Ø¹ÙˆÙŠØ¯", "Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø± ØµØ¯Ø§Ù… Ø¬Ø¯ÙŠØ¯", "Ù…Ø­Ù…Ø¯ Ø§Ù„ÙˆØ§Ø¦Ù„ÙŠ Ø¬Ø§Ø± ÙØ§Ø¸Ù„", "Ù…Ø­Ø³Ù† Ø§Ù„Ù‚Ø±ÙŠØ´ÙŠ Ø®Ù„Ù Ø§Ù„Ø¨Ø±Ø¬",
            "Ù…Ø­Ø³Ù† Ø§Ù„Ù‚Ø±ÙŠØ´ÙŠ Ø¬Ø§Ø± Ø§Ø¨Ùˆ ÙˆØ³Ø§Ù…", "ÙƒØ±Ø§ÙŠØ¨ Ù‚Ø§Ø³Ù… Ø¬Ø§Ø± Ø³ÙŠØ¯ Ù…Ø§Ù„Ùƒ", "ÙƒØ±Ø§Ø± Ù…Ø§Ù„Ùƒ", "ÙƒØ±Ø§Ø± Ø§Ø®Ùˆ Ø³Ø­Ø§Ø¯ ÙˆØ­ÙŠØ¯ 35",
            "ÙƒØ§Ø¸Ù… Ø¬Ø§Ø± Ø³Ø§Ù…Ø± 35", "ÙƒØ§Ø¸Ù… Ø¨ÙŠØª Ø§Ø¨Ùˆ Ø®Ù„Ù 35", "ÙØ±ÙŠ", "ÙØ§Ø¶Ù„ Ø¬Ø§Ø± Ø§Ù„Ø´Ø¨ÙƒØ© 35",
            "Ø¹Ù…Ø§Ø± ÙŠØ§Ø³Ø± Ø¬Ø§Ø± Ø­Ø³ÙŠÙ† ØµØ¯Ø§Ù…", "Ø¹Ù…Ø§Ø± ÙŠØ§Ø³Ø±", "Ø¹Ù„ÙŠ Ø­Ù„ÙŠÙ… Ø¬Ø¯Ø¨Ø¯", "Ø¹Ù„ÙŠ Ø§Ù„Ù…ØµÙˆØ±",
            "Ø¹Ù„ÙŠ Ø§Ù„Ø¯Ø±Ø§Ø¬ÙŠ Ø±ÙƒÙ† Ø§Ù„Ø´Ø¨Ø©", "Ø¹Ù„ÙŠ Ø§Ù„Ø¯Ø±Ø§Ø¬ÙŠ Ø¬Ø§Ø± Ù†ÙˆØ±", "Ø¹Ù„ÙŠ Ø§Ù„Ø¯Ø±Ø§Ø¬ÙŠ Ø¬Ø§Ø± Ø­ÙŠØ¯Ø± Ø§Ù„Ø®Ù„ÙØ©",
            "Ø¹Ù„ÙŠ Ø§Ø­Ù…Ø¯ Ù…Ø¬Ø§ÙˆØ± Ø§Ø¨Ùˆ Ø±Ù‚ÙŠØ© 35", "Ø¹Ù„Ø§ÙˆÙŠ Ø§Ù„Ø¹Ù†Ø²ÙŠ", "Ø¹Ù‚ÙŠÙ„ Ø§Ù„Ø·ÙŠØ¨ Ø®Ù„Ù", "Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¬Ø§Ø± Ø¹Ø¨Ø§Ø³",
            "Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¬Ø§Ø± Ø¶ÙŠØ§Ø¡", "Ø¹Ø¨Ø§Ø³ ÙƒØ±Ø§ÙŠØ¨ Ù‚Ø§Ø³Ù…", "Ø¹Ø¨Ø§Ø³ Ø§Ù„Ø³Ù…Ø§Ø¬", "Ø¹Ø§ÙŠØ¯ Ø§Ø¨Ù† Ø¨ÙŠØª Ø§Ø¨Ùˆ Ø¹Ø§ÙŠØ¯ 35",
            "Ø¶ÙŠØ§Ø¡ Ù…Ù‚Ø§Ø¨ÙŠÙ„ Ø¨ÙŠØª Ø­Ø³ÙŠÙ† ÙÙˆØ§Ø¯ 35", "ØµÙ„Ø§Ø­ Ø§Ø¨Ùˆ Ø¹Ù„ÙŠ Ø¬Ø§Ø± Ø§Ø¨Ùˆ Ù…ÙˆØ³Ù‰", "ØµÙ„Ø§Ø­ Ø§Ø¨Ùˆ Ø­ÙŠØ¯Ø±",
            "Ø´Ù…Ø±Ø§Ù† Ø¬Ø³Ø§Ù† ÙØ±Ø¹ Ø§Ø¨ÙˆØ¹Ù„Ø§Ø¡ 35 44801", "Ø³ÙŠÙ Ø§Ø¨Ùˆ Ø¹Ø¨Ø§Ø³", "Ø³ÙŠØ¯ Ù‡Ø§Ø¯ÙŠ Ø§Ø®Ùˆ Ø³ÙŠØ¯ Ù…Ù‡Ø¯ÙŠ Ø¶ÙŠØ§ ÙØ±Ø¹ Ø§Ù„ÙƒØ±Ø§Ø¬",
            "Ø³ÙŠØ¯ ÙØ§Ø¶Ù„", "Ø³ÙŠØ¯ Ø·Ø§Ù„Ø¨ Ù…Ø¹ Ø¬Ø§Ø±Ù‡", "Ø³Ù Ø³Ø¹Ø¯", "Ø³Ø¬Ø§Ø¯ Ø´Ø§Ø±Ø¹ Ø§Ù„Ø§Ø³ÙˆØ§Ù‚", "Ø³ØªØ§Ø± ÙØ±Ø¹ Ù…Ø­ÙŠÙ„",
            "Ø³Ø§Ù…Ø±", "Ø­ÙŠØ¯Ø± ÙƒØ±ÙŠÙ…", "Ø­ÙŠØ¯Ø± Ø³ÙŠØ¯ Ù…Ø§Ù„Ùƒ", "Ø­ÙŠØ¯Ø± Ø³Ø§Ø¨Ø·", "Ø­Ø³ÙŠÙ† Ø¬Ø§Ø± ÙƒØ±Ø§Ø±", "Ø­Ø³ÙŠÙ† Ø§Ø¨Ùˆ Ù„Ø­ÙŠØ©",
            "Ø­Ø³Ù† Ø§Ù„Ø®ÙŠÙƒØ§Ù†ÙŠ 35", "Ø¬ÙˆØ§Ø±ÙŠÙ† ÙÙ„ÙŠØ­", "Ø¬Ø¹ÙØ± Ù†Ø¹Ù…Ø§Ù†ÙŠØ©", "ØªØ§ØªØ§", "Ø¨ÙŠØª Ø¹Ù„ÙˆÙ„",
            "Ø¨ÙŠØª Ø§Ø¨Ùˆ ÙˆØ³Ø§Ù… Ø§Ù„Ù‚Ø±ÙŠØ´ÙŠ 35", "Ø§ÙˆØ³ Ø¬Ø§Ø± Ø§Ø¨Ùˆ Ø±Ù‚ÙŠØ©", "Ø§ÙˆØ³ Ø¬Ø§Ø± Ø§Ø¨Ùˆ Ø±Ù‚ÙŠØ©", "Ø§Ù… Ø±Ø¶Ø§ Ø¬Ø§Ø± Ø§ÙˆØ³",
            "Ø§Ù„Ø³Ø§Ø¹Ø¯ÙŠ 3", "Ø§Ù„Ø³Ø§Ø¹Ø¯ÙŠ", "Ø§Ø±Ø´Ø¯ Ø®Ù„Ù Ø´Ù…Ø±Ø§Ù†", "Ø§Ø­Ù…Ø¯ Ù†Ø¹ÙŠÙ…", "Ø§Ø­Ù…Ø¯ Ù…Ø¬ÙŠØ¯ Ø§Ø¨Ùˆ Ø§Ù„ÙƒÙŠØ© Ø¬ÙŠØ±Ø§Ù† Ø§ÙˆØ³ 35",
            "Ø§Ø­Ù…Ø¯ Ø¹Ø¨ÙˆØ¯ Ø¬Ø¯ÙŠØ¯", "Ø§Ø¨Ùˆ ÙŠÙˆØ³Ù Ø­Ø³Ù†ÙŠÙ†", "Ø§Ø¨Ùˆ Ù†ÙˆØ± ÙØ±Ø¹ Ø¶ÙŠØ§Ø¡", "Ø§Ø¨Ùˆ Ù…ÙˆØ³Ù‰ Ø¬Ø§Ø± Ø§Ø¨Ùˆ Ø¹Ù„Ø§Ø¡",
            "Ø§Ø¨Ùˆ Ù…Ù„Ø§Ùƒ Ù…Ù‚Ø§Ø¨ÙŠÙ„ Ø§Ø¨Ùˆ Ø±Ù‚ÙŠØ©", "Ø§Ø¨Ùˆ Ù…Ù‚ØªØ¯Ù‰", "Ø§Ø¨Ùˆ Ù…Ø¹ØµÙˆÙ…Ø© 35", "Ø§Ø¨Ùˆ Ù…ØµØ·ÙÙ‰ Ø¬Ø§Ø± Ø¹Ø§Ø¯Ù„ ØµÙØ±",
            "Ø§Ø¨Ùˆ Ø¹Ù„ÙŠ Ø¬Ø§Ø± Ù†ÙˆØ± ØªÙƒØªÙƒ", "Ø§Ø¨Ùˆ Ø¹Ø¨Ø§Ø³ ÙØªÙŠÙ†Ø©", "Ø§Ø¨Ùˆ Ø¹Ø¨Ø§Ø³ ÙØªÙŠÙ†Ø©", "Ø§Ø¨Ùˆ Ø³ÙŠÙ ÙØ±Ø¹ Ù…Ø­ÙŠÙ„ 35",
            "Ø§Ø¨Ùˆ Ø³ÙŠÙ Ø¹Ù… Ù…Ù‚ØªØ¯Ù‰", "Ø§Ø¨Ùˆ Ø³Ø¬Ø§Ø¯ Ø¬Ø§Ø± Ø§Ù„Ø¨Ø±Ø¬", "Ø§Ø¨Ùˆ Ø²ÙŠÙ†Ø¨ ÙƒÙ‡Ø±Ø¨Ø§Ø¡", "Ø§Ø¨Ùˆ Ø±Ù‚ÙŠÙ‡ Ø¬Ø§Ø± Ø§ÙˆØ³",
            "Ø§Ø¨Ùˆ Ø±Ù‚ÙŠØ© Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¨Ø¯Ùˆ", "Ø§Ø¨Ùˆ Ø±Ù‚ÙŠØ© Ø¬Ø§Ø± Ø§Ø­Ù…Ø¯ Ø¬Ø§ÙƒÙˆØ¬", "Ø§Ø¨Ùˆ Ø±Ø³ÙˆÙ„ Ø¬Ø§Ø± Ø§Ù„Ø¨Ø±Ø¬ 35",
            "Ø§Ø¨Ùˆ Ø­Ù…Ø±Ø© Ø´Ø§Ø±Ø¹ ÙƒØ±ÙŠØ´", "Ø§Ø¨Ùˆ Ø­Ù…Ø±Ø©", "Ø§Ø¨Ùˆ Ø­Ø³ÙŠÙ† Ø´Ø§Ø±Ø¹ Ù„ÙˆÙŠ 2", "Ø§Ø¨Ùˆ Ø­Ø³ÙŠÙ† Ø´Ø§Ø±Ø¹ Ø§Ø¨Ùˆ Ø¬Ù…Ø§Ù†Ø©",
            "Ø§Ø¨Ùˆ Ø§Ø­Ø³Ø§Ù† Ø¬Ø¯ÙŠØ¯", "Ø£Ø¨Ùˆ Ø²ÙŠÙ†Ø¨ Ø´Ø§Ø±Ø¹ Ø§Ø­Ù…Ø¯ Ø§Ø¨Ùˆ Ø§Ù„Ø§Ø³ÙˆØ§Ù‚ 1", "35 Ù…Ø­Ù…Ø¯ ÙƒØ±Ø§Ø¬ Ø§Ù„ØºØ§Ø² ØªÙŠØ²Ø§Ø¨",
            "Ø­Ù…Ø²Ø© Ø§Ù„Ù…ÙŠØ§Ø­ÙŠ", "Ø§Ø¨Ùˆ Ø¹Ù„Ø§Ø¡ Ø±ÙƒÙ†"
        ];

        window.importLegacySubscribers = async function () {
            const btn = document.getElementById('btn-import');
            const status = document.getElementById('import-status');

            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙŠØ±Ø§Ø¯ ' + legacyNames.length + ' Ù…Ø´ØªØ±ÙƒØŸ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ù… Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹.')) return;

            btn.disabled = true;
            status.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©... ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙˆØ¹Ø¯Ù… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©';

            let addedCount = 0;
            let skippedCount = 0;

            // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ† Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø±
            const currentSubs = DataManager.subscribers || [];
            const currentNames = new Set(currentSubs.map(s => s.name.trim()));

            for (const name of legacyNames) {
                if (currentNames.has(name.trim())) {
                    skippedCount++;
                    status.innerHTML = `âš ï¸ ØªØ®Ø·ÙŠ Ø§Ù„Ù…ÙƒØ±Ø±: ${name} (${addedCount + skippedCount}/${legacyNames.length})`;
                    continue;
                }

                try {
                    await DataManager.addSubscriber({
                        name: name.trim(),
                        phone: '', // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‡Ø§ØªÙ
                        initialPrice: 0, // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙŠÙ†
                        status: 'Ù†Ø´Ø·',
                        paymentType: 'Ù†Ù‚Ø¯',
                        expiryDate: '' // ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    });
                    addedCount++;
                    status.innerHTML = `âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ©: ${name} (${addedCount + skippedCount}/${legacyNames.length})`;
                    // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„ØªØ®ÙÙŠÙ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­
                    await new Promise(r => setTimeout(r, 50));
                } catch (e) {
                    console.error('Error adding ' + name, e);
                }
            }

            status.innerHTML = `ğŸ‰ ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡! ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${addedCount} Ù…Ø´ØªØ±Ùƒ Ø¨Ù†Ø¬Ø§Ø­. (ØªÙ… ØªØ®Ø·ÙŠ ${skippedCount} Ù…ÙƒØ±Ø±).`;
            btn.innerHTML = 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­';
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-success');

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
            renderPage();
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
            DataManager.showToast(`ğŸ‰ ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${addedCount} Ù…Ø´ØªØ±Ùƒ Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
        };
        // Menu Toggle Logic
        window.toggleMenu = function () {
            const nav = document.getElementById('main-nav');
            const overlay = document.querySelector('.nav-overlay');
            nav.classList.toggle('active');
            if (nav.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }
    </script>
</body>

</html>