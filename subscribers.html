<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المشتركين</title>
    <link rel="stylesheet" href="style.css?v=6">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="module" src="data-manager.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="logo"><i class="fas fa-users"></i> المشتركين</div>
        <ul class="nav-links">
            <li><a href="index.html"><i class="fas fa-home"></i> <span>الرئيسية</span></a></li>
            <li><a href="subscribers.html" class="active"><i class="fas fa-users"></i> <span>المشتركين</span></a></li>
            <li><a href="debts.html"><i class="fas fa-money-bill-wave"></i> <span>الديون</span></a></li>
            <li><a href="payments.html"><i class="fas fa-hand-holding-usd"></i> <span>المبالغ</span></a></li>
            <li><a href="expenses.html"><i class="fas fa-file-invoice-dollar"></i> <span>الصرفيات</span></a></li>
            <li><a href="reports.html"><i class="fas fa-chart-bar"></i> <span>التقارير</span></a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>قائمة المشتركين</h1>
            <button onclick="addSubscriber()" class="btn btn-primary"><i class="fas fa-plus"></i> إضافة مشترك</button>
        </div>

        <input type="text" id="search" class="search-box" placeholder="بحث بالاسم أو الهاتف..." onkeyup="renderPage()">

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>الاسم</th>
                        <th>الهاتف</th>
                        <th>الحالة</th>
                        <th>السعر</th>
                        <th>النوع</th>
                        <th>تحكم</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        window.renderPage = function() {
            if (typeof DataManager === 'undefined') return;
            const q = document.getElementById('search').value;
            const subs = DataManager.searchSubscribers(q);
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            subs.forEach(s => {
                let statusColor = s.status === 'نشط' ? 'var(--success-color)' : 'var(--warning-color)';
                tbody.innerHTML += `
                    <tr>
                        <td>${s.name}</td>
                        <td>${s.phone || '-'}</td>
                        <td style="color:${statusColor}; font-weight:bold;">${s.status}</td>
                        <td>${s.price.toLocaleString()}</td>
                        <td>${s.paymentType}</td>
                        <td>
                            <button onclick="editSub('${s.id}')" class="btn btn-primary" style="padding:5px 10px;"><i class="fas fa-edit"></i></button>
                            <button onclick="DataManager.deleteSubscriber('${s.id}')" class="btn btn-danger" style="padding:5px 10px;"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
        };

        window.addSubscriber = function() {
            const name = prompt("الاسم:");
            if(!name) return;
            const phone = prompt("الهاتف:");
            const price = prompt("سعر الاشتراك:", "0");
            const type = confirm("هل الدفع آجل (دين)؟") ? "أجل" : "نقد";
            
            DataManager.addSubscriber({
                name, phone, price, paymentType: type, status: "قيد الانتظار"
            });
        };

        window.editSub = function(id) {
            const s = DataManager.getSubscriber(id);
            const newPrice = prompt("تعديل السعر:", s.price);
            if(newPrice !== null) {
                // إذا تم وضع سعر، نعتبره مديونية (أجل) تلقائياً لتسهيل العمل
                DataManager.updateSubscriber(id, { price: parseInt(newPrice), paymentType: 'أجل' });
            }
        };

        setTimeout(renderPage, 1000);
    </script>
</body>
</html>
