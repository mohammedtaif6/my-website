<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ - OK Computer</title>
    <link rel="stylesheet" href="style.css?v=25.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="auth-system.js"></script>
    <script type="module">
        import { DataManager } from './data-manager.js';
        window.DataManager = DataManager;
        DataManager.init();
    </script>

    <style>
        .report-header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
        }

        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }

        .summary-card:hover {
            transform: translateY(-3px);
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 10px 0;
            color: var(--primary);
        }

        .summary-label {
            color: #666;
            font-size: 0.9rem;
        }

        .transactions-list {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .transaction-item {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .transaction-item:hover {
            background: #f9fafb;
        }

        .tx-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tx-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: #f0f2f5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .income {
            color: #10b981;
        }

        .expense {
            color: #ef4444;
        }

        @media (max-width: 600px) {
            .report-header {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                flex-direction: column;
            }

            .date-input {
                width: 100%;
            }
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„Ø£Ø±Ø´ÙØ© */
        .archive-btn {
            background: linear-gradient(135deg, #607d8b 0%, #455a64 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .archive-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(96, 125, 139, 0.3);
        }

        .toggle-archive-btn {
            background: transparent;
            border: 1px solid #ccc;
            color: #666;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
        }
    </style>
</head>

<body>
    <script>AuthSystem.checkSession();</script>

    <!-- Mobile Header & Toggle -->
    <button class="menu-btn" onclick="toggleMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar / Drawer Navigation -->
    <nav class="navbar" id="main-nav">
        <div class="header-card"
            style="margin: 0; background: none; box-shadow: none; border: none; padding: 0 0 20px 0;">
            <div class="logo" style="color: var(--primary); font-size: 1.5rem; margin-bottom: 0;">
                <i class="fas fa-chart-line"></i> OK Computer
            </div>
            <button class="close-menu" onclick="toggleMenu()"
                style="position: absolute; left: 0; top: 0;">&times;</button>
        </div>

        <ul class="nav-links">
            <li><a href="index.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li id="nav-subscribers"><a href="subscribers.html"><i class="fas fa-users"></i> Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</a></li>
            <li id="nav-active"><a href="active_subscribers.html"><i class="fas fa-signal"></i> Ø§Ù„ÙØ¹Ø§Ù„ÙŠÙ†</a></li>
            <li id="nav-debts"><a href="debts.html"><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ø¯ÙŠÙˆÙ†</a></li>
            <li id="nav-payments"><a href="payments.html"><i class="fas fa-hand-holding-usd"></i> Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</a></li>
            <li id="nav-reports"><a href="reports.html" class="active"><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
            </li>
            <li id="nav-employees"><a href="employees.html"><i class="fas fa-users-cog"></i> Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</a></li>
            <li id="nav-maintenance-log"><a href="maintenance-log.html"><i class="fas fa-clipboard-list"></i> Ø³Ø¬Ù„
                    Ø§Ù„ØµÙŠØ§Ù†Ø§Øª</a></li>
            <li id="nav-maintenance"><a href="maintenance.html"><i class="fas fa-wrench"></i> ØªØ³Ø¬ÙŠÙ„ ØµÙŠØ§Ù†Ø©</a></li>
            <li id="nav-telegram"><a href="telegram-settings.html"><i class="fab fa-telegram"></i> Telegram</a></li>
            <li><a href="#" onclick="AuthSystem.logout()"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</a></li>
        </ul>

        <div class="nav-overlay" onclick="toggleMenu()"></div>
    </nav>

    <div class="container" style="padding-bottom: 80px;">

        <!-- Header & Filters -->
        <div class="report-header">
            <h2 style="margin:0;">ğŸ“Š ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
            <div class="filter-group">
                <button id="show-archived-btn" class="toggle-archive-btn" onclick="toggleArchivedView()">
                    <i class="fas fa-history"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø³Ø§Ø¨Ù‚
                </button>
                <select id="report-period" class="date-input" onchange="updateReport()">
                    <option value="daily">ÙŠÙˆÙ…ÙŠ</option>
                    <option value="monthly" selected>Ø´Ù‡Ø±ÙŠ</option>
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                </select>
                <!-- Ø²Ø± Ø§Ù„Ø£Ø±Ø´ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
                <button onclick="archiveCurrentView()" class="archive-btn" id="archive-btn">
                    <i class="fas fa-box-archive"></i> Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                </button>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="report-summary">
            <div class="summary-card">
                <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‚Ø¨ÙˆØ¶Ø§Øª</div>
                <div class="summary-value income" id="total-income">0</div>
                <div style="font-size:0.8rem; color:#10b981;">
                    <i class="fas fa-arrow-up"></i> ÙˆØ§Ø±Ø¯Ø§Øª
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                <div class="summary-value expense" id="total-expense">0</div>
                <div style="font-size:0.8rem; color:#ef4444;">
                    <i class="fas fa-arrow-down"></i> Ù…ØµØ±ÙˆÙØ§Øª ÙˆØ±ÙˆØ§ØªØ¨
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">ØµØ§ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</div>
                <div class="summary-value" id="net-balance" style="color:var(--primary);">0</div>
                <div style="font-size:0.8rem; color:#666;">
                    Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
                </div>
            </div>
        </div>

        <!-- Transactions List -->
        <h3 style="margin-bottom:15px; color:#444;">ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª <span id="view-mode-label"
                style="font-size: 0.8rem; color:#888;">(Ù†Ø´Ø·)</span></h3>
        <div class="transactions-list" id="report-list">
            <div style="padding:40px; text-align:center; color:#999;">
                <i class="fas fa-spinner fa-spin fa-2x"></i>
                <p style="margin-top:10px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>
        </div>

    </div>

    <script type="module">
        import { DataManager } from './data-manager.js';

        let isViewArchived = false; // Ù‡Ù„ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø£Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØŸ

        window.generateReport = () => {
            const period = document.getElementById('report-period').value;
            let txs = DataManager.getAllTransactions();
            const list = document.getElementById('report-list');

            if (!txs) return;

            // 1. ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø£Ø±Ø´ÙŠÙ (Ù†Ø´Ø· Ø£Ùˆ Ù…Ø¤Ø±Ø´Ù)
            txs = txs.filter(t => isViewArchived ? t.isArchived : !t.isArchived);

            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†
            const viewLabel = document.getElementById('view-mode-label');
            const toggleBtn = document.getElementById('show-archived-btn');
            const archiveBtn = document.getElementById('archive-btn');

            if (isViewArchived) {
                viewLabel.innerText = "(Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø³Ø§Ø¨Ù‚)";
                viewLabel.style.color = "#ef4444";
                toggleBtn.innerHTML = '<i class="fas fa-chart-line"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©';
                toggleBtn.style.background = "#ffebee";
                toggleBtn.style.color = "#c62828";
                toggleBtn.style.border = "1px solid #ef5350";

                // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø£Ø±Ø´ÙØ© Ø¹Ù†Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
                archiveBtn.style.display = 'none';
            } else {
                viewLabel.innerText = "(Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©)";
                viewLabel.style.color = "#10b981";
                toggleBtn.innerHTML = '<i class="fas fa-history"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø³Ø§Ø¨Ù‚';
                toggleBtn.style.background = "transparent";
                toggleBtn.style.color = "#666";
                toggleBtn.style.border = "1px solid #ccc";

                // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø£Ø±Ø´ÙØ© Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                archiveBtn.style.display = 'flex';
            }

            // 2. ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø· Ø£Ùˆ Ø§Ù„Ø£Ø±Ø´ÙŠÙ)
            const now = new Date();
            txs = txs.filter(t => {
                const date = new Date(t.createdAt);

                // Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø¯ÙŠÙˆÙ† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
                if (t.type === 'subscription_debt') return false;

                if (period === 'daily') {
                    return date.getDate() === now.getDate() &&
                        date.getMonth() === now.getMonth() &&
                        date.getFullYear() === now.getFullYear();
                }
                if (period === 'monthly') {
                    return date.getMonth() === now.getMonth() &&
                        date.getFullYear() === now.getFullYear();
                }
                return true;
            });

            // Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
            const income = txs.filter(t => t.amount > 0).reduce((a, b) => a + b.amount, 0);
            const expense = txs.filter(t => t.amount < 0).reduce((a, b) => a + Math.abs(b.amount), 0);
            const net = income - expense;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ±ÙˆØª
            document.getElementById('total-income').innerText = income.toLocaleString();
            document.getElementById('total-expense').innerText = expense.toLocaleString();
            document.getElementById('net-balance').innerText = net.toLocaleString();

            // Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
            if (txs.length === 0) {
                list.innerHTML = `
                    <div style="padding:40px; text-align:center; color:#999;">
                        <i class="fas fa-file-invoice-dollar" style="font-size:3rem; opacity:0.3; margin-bottom:15px;"></i>
                        <p>${isViewArchived ? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ø´ÙŠÙ Ù…Ø·Ø§Ø¨Ù‚' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©'}</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = txs.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .map(t => {
                    const isIncome = t.amount > 0;
                    const date = new Date(t.createdAt);

                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§Ù„Ù„ÙˆÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
                    let icon = 'fa-money-bill-wave';
                    let typeLabel = isIncome ? 'Ù‚Ø¨Ø¶' : 'ØµØ±Ù';
                    let badge = '';

                    if (t.type === 'employee_advance') {
                        icon = 'fa-user-clock';
                        typeLabel = 'Ø³Ù„ÙØ© Ù…ÙˆØ¸Ù';
                        badge = '<span class="badge" style="background:#fff3e0; color:#e65100;">ğŸ’¸ Ø³Ù„ÙØ©</span> ';
                    } else if (t.type === 'employee_reward') {
                        icon = 'fa-gift';
                        typeLabel = 'Ù…ÙƒØ§ÙØ£Ø©';
                        badge = '<span class="badge" style="background:#e8f5e9; color:#2e7d32;">ğŸ Ù…ÙƒØ§ÙØ£Ø©</span> ';
                    } else if (t.type === 'salary_payment') {
                        icon = 'fa-money-check-alt';
                        typeLabel = 'Ø±Ø§ØªØ¨ Ø´Ù‡Ø±ÙŠ';
                        badge = '<span class="badge" style="background:#e3f2fd; color:#1565c0;">ğŸ’° Ø±Ø§ØªØ¨</span> ';
                    } else if (t.description && (t.description.includes('Ø±Ø§ØªØ¨') || t.description.includes('Ø³Ù„ÙØ©'))) {
                        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù…Ù† Ø§Ù„ÙˆØµÙ
                        badge = '<span class="badge" style="background:#f3e5f5; color:#7b1fa2;">ğŸ‘¤ Ù…ÙˆØ¸ÙÙŠÙ†</span> ';
                    }

                    return `
                    <div class="transaction-item">
                        <div class="tx-info">
                            <div class="tx-icon"><i class="fas ${icon}"></i></div>
                            <div>
                                <div style="font-weight:bold; color:#333;">${badge}${t.description || typeLabel}</div>
                                <div style="font-size:0.8rem; color:#888;">
                                    ${date.toLocaleDateString('ar-IQ')} - ${date.toLocaleTimeString('ar-IQ', { hour: '2-digit', minute: '2-digit' })}
                                </div>
                            </div>
                        </div>
                        <div style="font-weight:bold; font-size:1.1rem; direction:ltr;" class="${isIncome ? 'income' : 'expense'}">
                            ${isIncome ? '+' : '-'}${Math.abs(t.amount).toLocaleString()}
                        </div>
                    </div>
                `}).join('');
        };

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙˆØ§Ù„Ø­Ø§Ù„ÙŠ
        window.toggleArchivedView = () => {
            isViewArchived = !isViewArchived;
            window.generateReport();
        };

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„ØªØ±
        window.updateReport = () => {
            window.generateReport();
        };

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø£Ø±Ø´ÙØ©
        window.archiveCurrentView = async () => {
            const period = document.getElementById('report-period').value;
            if (period !== 'all' && !confirm('Ø£Ù†Øª ØªØ¹Ø±Ø¶ Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ÙŠÙˆÙ…ÙŠ/Ø´Ù‡Ø±ÙŠ). Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£Ø±Ø´ÙØ© ÙƒÙ„ Ø´ÙŠØ¡ Ù„ÙØªØ­ ÙØªØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŸ')) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙÙ„ØªØ±ØŒ Ù†Ø¨Ù‡Ù‡ Ø£Ù† Ø§Ù„Ø£Ø±Ø´ÙØ© Ø§Ù„Ø£ÙØ¶Ù„ ØªÙƒÙˆÙ† Ù„Ù„ÙƒÙ„ Ø£Ùˆ Ù†Ø£Ø±Ø´Ù Ø§Ù„Ø¸Ø§Ù‡Ø± ÙÙ‚Ø·ØŸ
                // Ø§Ù„Ø£ÙØ¶Ù„: Ø£Ø±Ø´ÙØ© ÙƒÙ„ Ù…Ø§ Ù‡Ùˆ "active" Ø­Ø§Ù„ÙŠØ§Ù‹.
            }

            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŸ\n\n- Ø³ÙŠØªÙ… ØªØµÙÙŠØ± Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯.\n- Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³Ø¬Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù„Ù† ØªØªØ£Ø«Ø±.\n- ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù…Ù† Ø®Ù„Ø§Ù„ Ø²Ø± "Ø§Ù„Ø£Ø±Ø´ÙŠÙ".')) {
                return;
            }

            try {
                const txs = DataManager.getAllTransactions().filter(t => !t.isArchived);
                if (txs.length === 0) {
                    DataManager.showToast('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø£Ø±Ø´ÙØªÙ‡Ø§!', 'error');
                    return;
                }

                // ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ø±Ø´ÙØ©
                let count = 0;
                for (const t of txs) {
                    // ØªØ­Ø¯ÙŠØ« ÙÙŠ Firebase (Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ù‚Ø¯ ÙŠØ£Ø®Ø° ÙˆÙ‚ØªØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ«ÙŠØ±Ø©)
                    // ÙÙŠ Ø¨ÙŠØ¦Ø© Ø¥Ù†ØªØ§Ø¬ÙŠØ© Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙŠÙØ¶Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Batch Write
                    await DataManager.updateTransaction(t.id, { isArchived: true });
                    count++;
                }

                DataManager.showToast(`âœ… ØªÙ… Ø£Ø±Ø´ÙØ© ${count} Ø­Ø±ÙƒØ© Ù…Ø§Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­`);
                window.generateReport(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶

            } catch (e) {
                console.error(e);
                DataManager.showToast('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø£Ø±Ø´ÙØ©: ' + e.message, 'error');
            }
        };

        // Initial Load
        setInterval(() => {
            if (typeof DataManager !== 'undefined' && DataManager.getAllTransactions()) {
                // ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… Ù†ÙƒÙ† Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ (Ù„Ø£Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø«Ø§Ø¨Øª)
                if (!isViewArchived) window.generateReport();
            }
        }, 5000);

        // Load once immediately when data is ready
        const checkData = setInterval(() => {
            if (typeof DataManager !== 'undefined' && DataManager.getAllTransactions && DataManager.getAllTransactions().length > 0) {
                window.generateReport();
                clearInterval(checkData);
            }
        }, 500);

        // Menu Toggle Logic
        window.toggleMenu = function () {
            const nav = document.getElementById('main-nav');
            const overlay = document.querySelector('.nav-overlay');
            nav.classList.toggle('active');
            if (nav.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }
    </script>
    <!-- Bottom Navigation Bar -->
    <div class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </a>
        <a href="subscribers.html" class="nav-item">
            <i class="fas fa-users"></i>
            <span>Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</span>
        </a>
        <a href="debts.html" class="nav-item">
            <i class="fas fa-money-bill-wave"></i>
            <span>Ø§Ù„Ø¯ÙŠÙˆÙ†</span>
        </a>
        <a href="reports.html" class="nav-item active">
            <i class="fas fa-chart-bar"></i>
            <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
        </a>
        <a href="#" class="nav-item" onclick="toggleMenu(); return false;">
            <i class="fas fa-bars"></i>
            <span>Ø§Ù„Ù…Ø²ÙŠØ¯</span>
        </a>
    </div>

</body>

</html>