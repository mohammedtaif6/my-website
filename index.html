<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>body{font-family:'Inter',sans-serif;background:#f3f4f6}.card{background:white;transition:transform .2s}.card:hover{transform:translateY(-2px)}</style>
</head>
<body class="bg-gray-100">
    <nav class="bg-blue-800 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-4 space-x-reverse text-white font-bold text-lg">
                    <i class="fas fa-chart-line text-2xl"></i>
                    <span>OKComputer</span>
                </div>
                <div class="hidden md:flex space-x-4 space-x-reverse">
                    <a href="index.html" class="text-white font-bold px-3 py-2 bg-white/20 rounded">الرئيسية</a>
                    <a href="subscribers.html" class="text-white hover:bg-white/10 px-3 py-2 rounded">المشتركين</a>
                    <a href="debts.html" class="text-white hover:bg-white/10 px-3 py-2 rounded">الديون</a>
                    <a href="payments.html" class="text-white hover:bg-white/10 px-3 py-2 rounded">المبالغ</a>
                    <a href="expenses.html" class="text-white hover:bg-white/10 px-3 py-2 rounded">الصرفيات</a>
                    <a href="reports.html" class="text-white hover:bg-white/10 px-3 py-2 rounded">التقارير</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="mb-8 bg-gradient-to-r from-blue-700 to-indigo-800 rounded-xl p-8 text-white shadow-lg">
            <h2 class="text-3xl font-bold mb-2">مرحباً بك</h2>
            <p class="text-blue-100">إدارة الاشتراكات أصبحت أسرع وأسهل</p>
            <p class="text-sm mt-2 opacity-75" id="current-date"></p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <a href="subscribers.html" class="card rounded-xl p-6 shadow-sm border border-gray-100 block">
                <div class="flex justify-between items-center mb-4">
                    <div class="p-3 bg-blue-100 rounded-lg text-blue-600"><i class="fas fa-users text-xl"></i></div>
                    <span class="text-xs text-gray-500 font-bold">إجمالي</span>
                </div>
                <h3 class="text-gray-500 text-sm font-bold">عدد المشتركين</h3>
                <p class="text-3xl font-bold text-gray-800 mt-1" id="stat-total">...</p>
            </a>

            <a href="expired.html" class="card rounded-xl p-6 shadow-sm border border-gray-100 block">
                <div class="flex justify-between items-center mb-4">
                    <div class="p-3 bg-red-100 rounded-lg text-red-600"><i class="fas fa-exclamation-triangle text-xl"></i></div>
                    <span class="text-xs text-gray-500 font-bold">تنبيه</span>
                </div>
                <h3 class="text-gray-500 text-sm font-bold">المنتهي اشتراكهم</h3>
                <p class="text-3xl font-bold text-gray-800 mt-1" id="stat-expired">...</p>
            </a>

            <a href="expiring.html" class="card rounded-xl p-6 shadow-sm border border-gray-100 block">
                <div class="flex justify-between items-center mb-4">
                    <div class="p-3 bg-orange-100 rounded-lg text-orange-600"><i class="fas fa-hourglass-half text-xl"></i></div>
                    <span class="text-xs text-gray-500 font-bold">قريباً</span>
                </div>
                <h3 class="text-gray-500 text-sm font-bold">على وشك الانتهاء</h3>
                <p class="text-3xl font-bold text-gray-800 mt-1" id="stat-expiring">...</p>
            </a>

            <a href="debts.html" class="card rounded-xl p-6 shadow-sm border border-gray-100 block">
                <div class="flex justify-between items-center mb-4">
                    <div class="p-3 bg-yellow-100 rounded-lg text-yellow-600"><i class="fas fa-money-bill text-xl"></i></div>
                    <span class="text-xs text-gray-500 font-bold">مستحقات</span>
                </div>
                <h3 class="text-gray-500 text-sm font-bold">الديون (أجل)</h3>
                <p class="text-3xl font-bold text-gray-800 mt-1" id="stat-debts">...</p>
            </a>

            <a href="payments.html" class="card rounded-xl p-6 shadow-sm border border-gray-100 block">
                <div class="flex justify-between items-center mb-4">
                    <div class="p-3 bg-green-100 rounded-lg text-green-600"><i class="fas fa-check-circle text-xl"></i></div>
                    <span class="text-xs text-gray-500 font-bold">إيرادات</span>
                </div>
                <h3 class="text-gray-500 text-sm font-bold">المبالغ المستلمة</h3>
                <p class="text-3xl font-bold text-gray-800 mt-1" id="stat-received">...</p>
            </a>

            <a href="expenses.html" class="card rounded-xl p-6 shadow-sm border border-gray-100 block">
                <div class="flex justify-between items-center mb-4">
                    <div class="p-3 bg-red-100 rounded-lg text-red-600"><i class="fas fa-receipt text-xl"></i></div>
                    <span class="text-xs text-gray-500 font-bold">مصروفات</span>
                </div>
                <h3 class="text-gray-500 text-sm font-bold">الصرفيات</h3>
                <p class="text-3xl font-bold text-gray-800 mt-1" id="stat-expenses">...</p>
            </a>
        </div>
    </main>

    <script type="module" src="data-manager.js"></script>
    <script>
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

        window.updateDashboard = function() {
            const stats = DataManager.getStatistics();
            const subs = DataManager.getSubscribers();
            const debts = subs.filter(s => s.paymentType === 'أجل' && s.price > 0).reduce((sum, s) => sum + (parseInt(s.price) || 0), 0);
            
            // حساب المبالغ المستلمة
            const received = subs.filter(s => s.paymentType === 'نقد' && s.price > 0).reduce((sum, s) => sum + (parseInt(s.price) || 0), 0) +
                            subs.filter(s => s.lastPaymentDate && s.originalPrice > 0).reduce((sum, s) => sum + (parseInt(s.originalPrice) || 0), 0);
            
            // حساب الصرفيات من localStorage
            let expenses = 0;
            const expensesData = JSON.parse(localStorage.getItem('expenses') || '[]');
            if (Array.isArray(expensesData)) {
                expenses = expensesData.reduce((sum, e) => sum + (parseInt(e.amount) || 0), 0);
            }

            // حساب الصافي (المبالغ المستلمة - الصرفيات)
            const netReceived = received - expenses;

            document.getElementById('stat-total').textContent = stats.totalSubscribers;
            document.getElementById('stat-expired').textContent = stats.expiredSubscribers;
            document.getElementById('stat-expiring').textContent = stats.expiringSubscribers;
            document.getElementById('stat-debts').textContent = debts.toLocaleString() + ' د.ع';
            document.getElementById('stat-received').textContent = netReceived.toLocaleString() + ' د.ع';
            document.getElementById('stat-expenses').textContent = expenses.toLocaleString() + ' د.ع';
        }
    </script>
</body>
</html>
