<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>المبالغ المستلمة</title>
    <link rel="stylesheet" href="style.css?v=9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="module" src="data-manager.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="logo"><i class="fas fa-hand-holding-usd"></i> المبالغ</div>
        <ul class="nav-links">
            <li><a href="index.html"><i class="fas fa-home"></i> <span>الرئيسية</span></a></li>
            <li><a href="subscribers.html"><i class="fas fa-users"></i> <span>المشتركين</span></a></li>
            <li><a href="debts.html"><i class="fas fa-money-bill-wave"></i> <span>الديون</span></a></li>
            <li><a href="payments.html" class="active"><i class="fas fa-hand-holding-usd"></i> <span>المبالغ</span></a></li>
            <li><a href="expenses.html"><i class="fas fa-file-invoice-dollar"></i> <span>الصرفيات</span></a></li>
            <li><a href="reports.html"><i class="fas fa-chart-bar"></i> <span>التقارير</span></a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>المقبوضات (الصندوق اليومي)</h1>
            <button onclick="DataManager.archiveDay()" class="btn btn-purple"><i class="fas fa-file-export"></i> ترحيل للأرشيف</button>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>المشترك</th>
                        <th>المبلغ</th>
                        <th>النوع</th>
                        <th>التاريخ</th>
                        <th>تراجع</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        window.renderPage = function() {
            if (typeof DataManager === 'undefined') return;
            const trans = DataManager.getAllTransactions();
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (trans.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:30px;">لا توجد مقبوضات في الصندوق</td></tr>';
            } else {
                trans.sort((a,b) => b.id - a.id).forEach(t => {
                    const sub = DataManager.getSubscriber(t.subscriberId);
                    tbody.innerHTML += `
                        <tr>
                            <td>${sub ? sub.name : 'محذوف'}</td>
                            <td style="color:var(--success-color); font-weight:bold;">${t.amount.toLocaleString()}</td>
                            <td>${t.type}</td>
                            <td>${t.date}</td>
                            <td>
                                <button onclick="DataManager.deleteTransaction('${t.id}')" class="btn btn-danger btn-sm">
                                    <i class="fas fa-undo"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
        };
        setInterval(() => { if(typeof DataManager !== 'undefined') renderPage(); }, 1000);
    </script>
</body>
</html>
