<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - OK Computer</title>
    <link rel="stylesheet" href="style.css?v=25.0">
    <link rel="stylesheet" href="style-fab.css?v=1.0">
    <link rel="stylesheet" href="style-modal.css?v=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="auth-system.js?v=3.0"></script>
    <script>
        // Anti-Flicker: Apply visibility as fast as possible
        (function () {
            const settings = JSON.parse(localStorage.getItem('sas_settings') || '{}');
            const style = document.createElement('style');
            let css = '';
            ['nav-subscribers', 'nav-active', 'nav-debts', 'nav-payments', 'nav-reports', 'nav-employees', 'nav-telegram'].forEach(id => {
                if (settings[id] === false) css += `#${id} { display: none !important; } `;
            });
            style.innerHTML = css;
            document.head.appendChild(style);
        })();
        AuthSystem.checkSession();
    </script>

    <style>
        .settings-header {
            background: linear-gradient(135deg, #475569 0%, #1e293b 100%);
            padding: 30px 20px;
            border-radius: 0 0 30px 30px;
            color: white;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(30, 41, 59, 0.3);
        }

        .settings-header h1 {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0 0 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .settings-header p {
            opacity: 0.7;
            margin: 0;
            font-size: 0.9rem;
        }

        .settings-section {
            background: white;
            border-radius: 20px;
            margin: 0 15px 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            overflow: hidden;
        }

        .section-title {
            background: #f8fafc;
            padding: 18px 20px;
            font-weight: 700;
            font-size: 1.05rem;
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-item {
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #f1f5f9;
            transition: background 0.2s;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-item:hover {
            background: #f8fafc;
        }

        .setting-label {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            color: #334155;
        }

        .setting-label i {
            width: 35px;
            height: 35px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
        }

        .setting-label .icon-blue {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .setting-label .icon-teal {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
        }

        .setting-label .icon-red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .setting-label .icon-purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .setting-label .icon-indigo {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .setting-label .icon-orange {
            background: linear-gradient(135deg, #f97316, #ea580c);
        }

        .setting-label .icon-gray {
            background: linear-gradient(135deg, #64748b, #475569);
        }

        .setting-label .icon-dark {
            background: linear-gradient(135deg, #334155, #1e293b);
        }

        .setting-label .icon-green {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            border-radius: 28px;
            transition: 0.3s;
        }

        .toggle-slider:before {
            content: "";
            position: absolute;
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            border-radius: 50%;
            transition: 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        .toggle-switch input:checked+.toggle-slider {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .toggle-switch input:checked+.toggle-slider:before {
            transform: translateX(24px);
        }

        /* Input fields */
        .setting-input {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
            color: #334155;
            width: 160px;
            text-align: center;
            transition: border-color 0.2s;
            direction: rtl;
        }

        .setting-input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Reset Button */
        .reset-btn {
            margin: 0 15px 30px;
            padding: 16px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: calc(100% - 30px);
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        .save-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1e293b;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9rem;
            z-index: 9999;
            transition: transform 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .save-toast.show {
            transform: translateX(-50%) translateY(0);
        }

        @media (max-width: 600px) {
            .setting-input {
                width: 120px;
            }
        }
    </style>
</head>

<body>
    <button class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>

    <nav class="navbar" id="main-nav">
        <div class="header-card" style="margin:0; background:none; box-shadow:none; border:none; padding:0 0 20px 0;">
            <div class="logo" style="color: var(--primary); font-size: 1.5rem; margin-bottom: 0;">
                <i class="fas fa-chart-line"></i> OK Computer
            </div>
            <button class="close-menu" onclick="toggleMenu()"
                style="position: absolute; left: 0; top: 0;">&times;</button>
        </div>
        <ul class="nav-links">
            <li><a href="index.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="subscribers.html"><i class="fas fa-users"></i> Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</a></li>
            <li><a href="active_subscribers.html"><i class="fas fa-signal"></i> Ø§Ù„ÙØ¹Ø§Ù„ÙŠÙ†</a></li>
            <li><a href="debts.html"><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ø¯ÙŠÙˆÙ†</a></li>
            <li><a href="payments.html"><i class="fas fa-hand-holding-usd"></i> Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</a></li>
            <li><a href="reports.html"><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a></li>
            <li><a href="employees.html"><i class="fas fa-users-cog"></i> Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</a></li>
            <li><a href="telegram-settings.html"><i class="fab fa-telegram"></i> Telegram</a></li>
            <li><a href="settings.html" class="active"><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></li>
            <li><a href="#" onclick="AuthSystem.logout()"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</a></li>
        </ul>
        <div class="nav-overlay" onclick="toggleMenu()"></div>
    </nav>

    <div class="settings-header">
        <h1><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
        <p>Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¹Ø±Ø¶</p>
    </div>

    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© -->
    <div class="settings-section">
        <div class="section-title"><i class="fas fa-sliders-h"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©</div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-indigo fas fa-tag"></i>
                <span>Ø§Ø³Ù… Ø§Ù„Ù†Ø¸Ø§Ù…</span>
            </div>
            <input type="text" class="setting-input" id="set-system-name" value="OK Computer">
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-green fas fa-money-bill"></i>
                <span>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</span>
            </div>
            <input type="number" class="setting-input" id="set-default-price" value="35000">
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-blue fas fa-calendar-alt"></i>
                <span>Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø£ÙŠØ§Ù…)</span>
            </div>
            <input type="number" class="setting-input" id="set-sub-duration" value="30">
        </div>
    </div>

    <!-- ÙƒØ±ÙˆØª Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
    <div class="settings-section">
        <div class="section-title"><i class="fas fa-th-large"></i> ÙƒØ±ÙˆØª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-blue fas fa-users"></i>
                <span>Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="card-subscribers-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-teal fas fa-signal"></i>
                <span>Ø§Ù„ÙØ¹Ø§Ù„ÙŠÙ†</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="card-active-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-red fas fa-money-bill-wave"></i>
                <span>Ø§Ù„Ø¯ÙŠÙˆÙ†</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="card-debts-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-purple fas fa-wallet"></i>
                <span>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="card-payments-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-indigo fas fa-chart-bar"></i>
                <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="card-reports-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-orange fas fa-user-tie"></i>
                <span>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="card-employees-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-orange fas fa-exclamation-triangle"></i>
                <span>ØªÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="card-expiring-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-gray fas fa-times-circle"></i>
                <span>Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="card-expired-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-dark fab fa-telegram-plane"></i>
                <span>Ø¨ÙˆØª Ø§Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="card-telegram-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>

    <!-- ØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <div class="settings-section">
        <div class="section-title"><i class="fas fa-bars"></i> Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©</div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-blue fas fa-users"></i>
                <span>Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="nav-subscribers-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-teal fas fa-signal"></i>
                <span>Ø§Ù„ÙØ¹Ø§Ù„ÙŠÙ†</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="nav-active-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-red fas fa-money-bill-wave"></i>
                <span>Ø§Ù„Ø¯ÙŠÙˆÙ†</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="nav-debts-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-purple fas fa-hand-holding-usd"></i>
                <span>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="nav-payments-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-indigo fas fa-chart-bar"></i>
                <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="nav-reports-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-orange fas fa-users-cog"></i>
                <span>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="nav-employees-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <i class="icon-dark fab fa-telegram"></i>
                <span>Telegram</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="nav-telegram-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>

    <!-- Ø²Ø± Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø¬Ø¯ÙŠØ¯) -->
    <button class="save-btn" onclick="saveAllSettings()"
        style="background: var(--primary); color: white; width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; cursor: pointer; box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);">
        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    </button>

    <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† -->
    <button class="reset-btn" onclick="resetAllSettings()">
        <i class="fas fa-undo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    </button>

    <!-- Toast -->
    <div class="save-toast" id="saveToast">âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>

    <script>
        const SETTINGS_KEY = 'sas_settings';

        // === ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===
        function loadSettings() {
            console.log("ğŸ› ï¸ UI: loadSettings() triggered");

            // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† DataManager (Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹) Ù…Ø¹ ØªÙØ¶ÙŠÙ„ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø­Ø§Ø¨ ÙØ§Ø±ØºØ§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            const cloudSettings = (typeof DataManager !== 'undefined' && DataManager.getSystemSettings)
                ? DataManager.getSystemSettings() : {};
            const localSettings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{}');

            // Ø¯Ù…Ø¬ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (ØªÙØ¶ÙŠÙ„ Ø§Ù„Ø³Ø­Ø§Ø¨ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª)
            const settings = Object.keys(cloudSettings).length > 0 ? cloudSettings : localSettings;

            console.log("ğŸ“¦ UI: Applying settings to fields:", settings);

            if (Object.keys(settings).length === 0) {
                console.log("â„¹ï¸ No settings found in Cloud or LocalStorage.");
                return;
            }

            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©
            if (settings.systemName) document.getElementById('set-system-name').value = settings.systemName;
            if (settings.defaultPrice) document.getElementById('set-default-price').value = settings.defaultPrice;
            if (settings.subDuration) document.getElementById('set-sub-duration').value = settings.subDuration;

            // ÙƒØ±ÙˆØª Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
            const toggleMap = {
                'card-subscribers': 'card-subscribers-toggle',
                'card-active': 'card-active-toggle',
                'card-debts': 'card-debts-toggle',
                'card-payments': 'card-payments-toggle',
                'card-reports': 'card-reports-toggle',
                'nav-card-employees': 'card-employees-toggle',
                'card-expiring': 'card-expiring-toggle',
                'card-expired': 'card-expired-toggle',
                'nav-card-telegram': 'card-telegram-toggle'
            };

            for (const [key, id] of Object.entries(toggleMap)) {
                const el = document.getElementById(id);
                if (el) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®ÙŠØ§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ (undefined)ØŒ Ù†Ø¹ØªØ¨Ø±Ù‡ true Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
                    el.checked = settings[key] !== false;
                }
            }

            // ØµÙØ­Ø§Øª Ø§Ù„Ù†Ø§ÙØ¨Ø§Ø±
            const navKeys = ['nav-subscribers', 'nav-active', 'nav-debts', 'nav-payments', 'nav-reports', 'nav-employees', 'nav-telegram'];
            navKeys.forEach(key => {
                const el = document.getElementById(key + '-toggle');
                if (el) el.checked = settings[key] !== false;
            });
        }

        // Ø¬Ø¹Ù„ loadSettings Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ Ù„Ù€ DataManager
        window.loadSettings = loadSettings;

        // === Ø­ÙØ¸ Ø§Ù„ÙƒÙ„ ===
        async function saveAllSettings() {
            console.log("ğŸš€ UI: saveAllSettings() started");
            const settings = {};

            // 1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
            settings.systemName = document.getElementById('set-system-name').value;
            settings.defaultPrice = parseInt(document.getElementById('set-default-price').value || 35000);
            settings.subDuration = parseInt(document.getElementById('set-sub-duration').value || 30);

            // 2. ÙƒØ±ÙˆØª Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
            const toggleMap = {
                'card-subscribers': 'card-subscribers-toggle',
                'card-active': 'card-active-toggle',
                'card-debts': 'card-debts-toggle',
                'card-payments': 'card-payments-toggle',
                'card-reports': 'card-reports-toggle',
                'nav-card-employees': 'card-employees-toggle',
                'card-expiring': 'card-expiring-toggle',
                'card-expired': 'card-expired-toggle',
                'nav-card-telegram': 'card-telegram-toggle'
            };
            for (const [key, id] of Object.entries(toggleMap)) {
                const el = document.getElementById(id);
                if (el) settings[key] = el.checked;
            }

            // 3. Ø§Ù„Ù†Ø§ÙØ¨Ø§Ø±
            const navKeys = ['nav-subscribers', 'nav-active', 'nav-debts', 'nav-payments', 'nav-reports', 'nav-employees', 'nav-telegram'];
            navKeys.forEach(key => {
                const el = document.getElementById(key + '-toggle');
                if (el) settings[key] = el.checked;
            });

            console.log("ğŸ“¤ UI: Sending data to DataManager:", settings);

            if (typeof DataManager !== 'undefined' && DataManager.saveAllSystemSettings) {
                try {
                    await DataManager.saveAllSystemSettings(settings);
                    console.log("âœ… UI: Remote save successful");
                    showSaveToast('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹ Ø¨Ù†Ø¬Ø§Ø­');
                } catch (err) {
                    console.error("âŒ UI: Remote save failed:", err);
                    showSaveToast('âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ - ØªÙÙ‚Ø¯ Ø§Ù„ÙƒÙˆÙ†Ø³Ù„');
                }
            } else {
                console.warn("âš ï¸ UI: DataManager not found, falling back to LocalStorage");
                localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
                showSaveToast('âš ï¸ ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·');
            }
        }



        // === Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ===
        function resetAllSettings() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŸ')) return;
            // Ù„Ù„ØªØµÙÙŠØ± Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØŒ Ø³Ù†Ø­ØªØ§Ø¬ Ù„Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø£Ùˆ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„.
            // Ù„Ù„ØªØ¨Ø³ÙŠØ·ØŒ Ø³Ù†Ù…Ø³Ø­ Ø§Ù„Ù€ localStorage ÙˆÙ†Ø·Ù„Ø¨ Ø§Ù„Ø­Ø°Ù ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø£Ùˆ Ù†ØªØ±ÙƒÙ‡Ø§
            localStorage.removeItem(SETTINGS_KEY);
            showSaveToast('ğŸ”„ ØªÙ… Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„ÙŠ. Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„ÙŠ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù….');
            loadSettings();
        }

        // === Toast ===
        function showSaveToast(msg) {
            const toast = document.getElementById('saveToast');
            toast.innerText = msg || 'âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // === Menu Toggle ===
        window.toggleMenu = function () {
            const nav = document.getElementById('main-nav');
            nav.classList.toggle('active');
            document.body.style.overflow = nav.classList.contains('active') ? 'hidden' : '';
        };

        // ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
        loadSettings();
    </script>
    <script type="module">
        import { DataManager } from './data-manager.js?v=28.0';
        window.DataManager = DataManager;
        DataManager.init();
    </script>
</body>

</html>